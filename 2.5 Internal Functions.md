# 🧩 Backend Internal Functions

This document lists all reusable internal functions in the Poker Backend application to prevent code duplication.

## 📁 app_core/poker_event/
### 📌 utils.py
>
>---
>#### ▶️ validate_init_data()
>    Validates the initData string passed from Telegram WebApp using HMAC-SHA256.
>    *Note: Ensures the request originates from Telegram.*
>
>>**Parameters:**
>>
>>| Parameter   | Type     | Required | Description                                             | Origin                                                           |
>>|-------------|----------|----------|---------------------------------------------------------|------------------------------------------------------------------|
>>| `init_data` | `string` | Yes      | Raw URL-encoded initData string from Telegram WebApp. | `request.data['initData']` in [`views.verify_telegram_user`](#️-verify_telegram_user) |
>>
>>**Return:**
>>
>>`boolean`: `True` if the data's hash matches the computed hash, `False` otherwise.
>>
>>**Function Definition:**
>>```python
>># app_core/poker_event/utils.py
>>def validate_init_data(init_data: str) -> bool:
>>    ...
>>    return hmac.compare_digest(computed_hash, hash_to_check)
>>```
>>
>> **Sample Call:**
>>```python
>># app_core/poker_event/views.py -> verify_telegram_user
>>if not validate_init_data(init_data):
>>    return Response(...)
>>```
>>
>
>---
### 📌 models.py
>---
>#### ▶️  set_auth_key()
>>
>># Under development
>>
>---
>#### ▶️  check_auth_key()
>>
>># Under development
>>
>#### ▶️  update_last_login()
>    Updates the player's last login timestamp and saves only that specific field.
>    *Note: While this method exists, the [`VerifyUserSerializer.save`](#️-save) method currently updates the timestamp directly.*
>
>>**Parameters:**
>>
>>| Parameter | Type      | Required | Description                            | Origin        |
>>|-----------|-----------|----------|----------------------------------------|---------------|
>>| `self`    | `Player`  | Implicit | The instance of the Player model itself. | Method call   |
>>
>>**Return:** 
>>
>>`None`
>>
>>* It modifies the `last_login` instance of the player and saves the change to the database. 
>>
>>**Function Definition:**
>>```python
>># app_core/poker_event/models.py -> class Player
>>def update_last_login(self):
>>```
>>
>> **Sample Call:**
>>```python
>># NOTE: This method is currently not called directly in the codebase.
>># The 'VerifyUserSerializer.save' method updates 'last_login' manually.
>># If it were to be used, a potential call site might look like this:
>>
>># Example hypothetical usage:
>>player.update_last_login() # Call the method to update timestamp
>>
>># The current direct update happening in VerifyUserSerializer.save:
>># player = self.validated_data["player"]
>># player.last_login = now()
>># player.save(update_fields=["last_login"])
>>```
>>
### 📌 serializers.py
>
>#### 📃 PlayerSerializer
>> *Currently no internal methods documented.*
>
>#### 📃 VerifyUserSerializer
>>
>># Under development
>>
>
>#### 📃 CreateGameSerializer
>>---
>>##### ▶️ create()
>>    Creates a new game instance and schedules future sessions if required.
>>
>>>**Parameters:**
>>>
>>>| Parameter | Type   | Required | Description                            | Origin              |
>>>|-----------|--------|----------|----------------------------------------|---------------------|
>>>| `self`    | `Serializer` | Implicit | The serializer instance.               | DRF internal call |
>>>| `validated_data` | `dict` | Yes | The validated data for creating a game. | DRF `serializer.save()` |
>>>
>>>**Return:**
>>>
>>>`Game` object that was created.
>>>
>>>**Function Definition:**
>>>```python
>>># app_core/poker_event/serializers.py -> CreateGameSerializer
>>>def create(self, validated_data):
>>>    # Finds host, creates game, schedules future sessions
>>>```
>>
>>---
>>##### ▶️ get_repeat_count()
>>    Returns the number of times a game should repeat based on its regularity setting.
>>
>>>**Parameters:**
>>>
>>>| Parameter | Type   | Required | Description                | Origin              |
>>>|-----------|--------|----------|----------------------------|---------------------|
>>>| `self`    | `Serializer` | Implicit | The serializer instance.   | Method call |
>>>| `regularity` | `string` | Yes | The regularity setting (weekly, fortnightly, monthly). | From validated data |
>>>
>>>**Return:**
>>>
>>>`int` representing the number of repeat events to create.
>>>
>>>**Function Definition:**
>>>```python
>>># app_core/poker_event/serializers.py -> CreateGameSerializer
>>>def get_repeat_count(self, regularity):
>>>    # Returns 4 for weekly, 2 for fortnightly, 1 for monthly, 0 otherwise
>>>```
>>
>>---
>>##### ▶️ get_next_date()
>>    Calculates the next event date based on regularity.
>>
>>>**Parameters:**
>>>
>>>| Parameter | Type   | Required | Description                | Origin              |
>>>|-----------|--------|----------|----------------------------|---------------------|
>>>| `self`    | `Serializer` | Implicit | The serializer instance.   | Method call |
>>>| `current_date` | `date` | Yes | The date to calculate from. | Game date from validated data |
>>>| `regularity` | `string` | Yes | The regularity setting. | From validated data |
>>>| `multiplier` | `int` | Yes | Which occurrence to calculate. | Iteration counter |
>>>
>>>**Return:**
>>>
>>>`date` object with the calculated next date.
>>>
>>>**Function Definition:**
>>>```python
>>># app_core/poker_event/serializers.py -> CreateGameSerializer
>>>def get_next_date(self, current_date, regularity, multiplier):
>>>    # Calculates date based on weeks or days (30 for monthly)
>>>```
>>
>>---
>>##### ▶️ schedule_future_game_sessions()
>>    Creates separate future game sessions based on regularity setting.
>>
>>>**Parameters:**
>>>
>>>| Parameter | Type   | Required | Description                | Origin              |
>>>|-----------|--------|----------|----------------------------|---------------------|
>>>| `self`    | `Serializer` | Implicit | The serializer instance.   | Method call |
>>>| `regularity` | `string` | Yes | The regularity setting. | From validated data |
>>>| `base_game` | `Game` | Yes | The original game object. | Newly created game |
>>>| `game_date` | `date` | Yes | The original game date. | From validated data |
>>>| `game_data` | `dict` | Yes | Game configuration data. | From validated data |
>>>
>>>**Return:**
>>>
>>>List of `Game` objects that were created as future occurrences.
>>>
>>>**Function Definition:**
>>>```python
>>># app_core/poker_event/serializers.py -> CreateGameSerializer
>>>def schedule_future_game_sessions(self, regularity, base_game, game_date, game_data):
>>>    # Loops based on repeat count, calculates next date, creates new Game instance
>>>```
>>
>>---
>>##### ▶️ post_to_social_media()
>>>
>>># Under development
>>>
>
>#### 📃 AllGameSerializer
>>---
>>##### ▶️ get_host()
>>    Retrieves the telegram_id, first_name, last_name of the Game host.
>>
>>>**Parameters:**
>>>
>>>| Parameter | Type   | Required | Description                | Origin              |
>>>|-----------|--------|----------|----------------------------|---------------------|
>>>| `self`    | `Serializer` | Implicit | The serializer instance.   | DRF internal call |
>>>| `obj` | `Game` | Yes | The game object being serialized. | From queryset |
>>>
>>>**Return:**
>>>
>>>`string` containing formatted host information or `None`.
>>>
>>>**Function Definition:**
>>>```python
>>># app_core/poker_event/serializers.py -> AllGameSerializer
>>>def get_host(self, obj):
>>>    # Returns formatted string "{telegram_id} {first_name} {last_name}"
>>>```
>
>#### 📃 JoinGameSerializer
>>---
>>##### ▶️ create()
>>    Handles adding a player to a Game.
>>
>>>**Parameters:**
>>>
>>>| Parameter | Type   | Required | Description                | Origin              |
>>>|-----------|--------|----------|----------------------------|---------------------|
>>>| `self`    | `Serializer` | Implicit | The serializer instance.   | DRF internal call |
>>>| `validated_data` | `dict` | Yes | The validated data for joining a game. | DRF `serializer.save()` |
>>>
>>>**Return:**
>>>
>>>`GameSessionPlayer` object representing the player joining the game.
>>>
>>>**Function Definition:**
>>>```python
>>># app_core/poker_event/serializers.py -> JoinGameSerializer
>>>def create(self, validated_data):
>>>    # Finds player/game, performs validation (capacity, already joined), creates GameSessionPlayer
>>>```
>
>#### 📃 GameDetailSerializer
>>---
>>##### ▶️ get_player_count()
>>    Count the number of players in the game.
>>
>>>**Parameters:**
>>>
>>>| Parameter | Type   | Required | Description                | Origin              |
>>>|-----------|--------|----------|----------------------------|---------------------|
>>>| `self`    | `Serializer` | Implicit | The serializer instance.   | DRF internal call |
>>>| `obj` | `Game` | Yes | The game object being serialized. | From queryset |
>>>
>>>**Return:**
>>>
>>>`int` representing the count of players in the game.
>>>
>>>**Function Definition:**
>>>```python
>>># app_core/poker_event/serializers.py -> GameDetailSerializer
>>>def get_player_count(self, obj):
>>>    # Counts GameSessionPlayer objects for the game
>>>```
>>
>>---
>>##### ▶️ get_players()
>>    Get a list of players (first_name, last_name, telegram_id) currently in the Game.
>>
>>>**Parameters:**
>>>
>>>| Parameter | Type   | Required | Description                | Origin              |
>>>|-----------|--------|----------|----------------------------|---------------------|
>>>| `self`    | `Serializer` | Implicit | The serializer instance.   | DRF internal call |
>>>| `obj` | `Game` | Yes | The game object being serialized. | From queryset |
>>>
>>>**Return:**
>>>
>>>List of dictionaries containing player details (`player_id__first_name`, `player_id__last_name`, `player_id__telegram_id`).
>>>
>>>**Function Definition:**
>>>```python
>>># app_core/poker_event/serializers.py -> GameDetailSerializer
>>>def get_players(self, obj):
>>>    # Filters GameSessionPlayer objects and returns values list
>>>```
>
>#### 📃 JoinedPlayerSerializer
>>---
>>##### ▶️ get_payment_status()
>>    Check if the player has paid the deposit for the game.
>>
>>>**Parameters:**
>>>
>>>| Parameter | Type   | Required | Description                | Origin              |
>>>|-----------|--------|----------|----------------------------|---------------------|
>>>| `self`    | `Serializer` | Implicit | The serializer instance.   | DRF internal call |
>>>| `obj` | `Player` | Yes | The player object being serialized. | From queryset |
>>>
>>>**Return:**
>>>
>>>`string` with payment status (e.g., "paid", "pending").
>>>
>>>**Function Definition:**
>>>```python
>>># app_core/poker_event/serializers.py -> JoinedPlayerSerializer
>>>def get_payment_status(self, obj):
>>>    # Gets game from context, queries GameSessionDeposit, returns status or "pending"
>>>```
>
>#### 📃 HostingGameSerializer
>>---
>>##### ▶️ get_players_joined()
>>    Fetch players who joined the game.
>>
>>>**Parameters:**
>>>
>>>| Parameter | Type   | Required | Description                | Origin              |
>>>|-----------|--------|----------|----------------------------|---------------------|
>>>| `self`    | `Serializer` | Implicit | The serializer instance.   | DRF internal call |
>>>| `obj` | `Game` | Yes | The game object being serialized. | From queryset |
>>>
>>>**Return:**
>>>
>>>Serialized list of joined players using `JoinedPlayerSerializer`.
>>>
>>>**Function Definition:**
>>>```python
>>># app_core/poker_event/serializers.py -> HostingGameSerializer
>>>def get_players_joined(self, obj):
>>>    # Filters GameSessionPlayer, extracts players, serializes with JoinedPlayerSerializer
>>>```
>
>#### 📃 JoinedGameSerializer
>>---
>>##### ▶️ get_player_count()
>>    Count the number of players in the game.
>>
>>>**Parameters:**
>>>
>>>| Parameter | Type   | Required | Description                | Origin              |
>>>|-----------|--------|----------|----------------------------|---------------------|
>>>| `self`    | `Serializer` | Implicit | The serializer instance.   | DRF internal call |
>>>| `obj` | `Game` | Yes | The game object being serialized. | From queryset |
>>>
>>>**Return:**
>>>
>>>`int` representing the count of players in the game.
>>>
>>>**Function Definition:**
>>>```python
>>># app_core/poker_event/serializers.py -> JoinedGameSerializer
>>>def get_player_count(self, obj):
>>>    # Counts GameSessionPlayer objects for the game
>>>```
>>
>>---
>>##### ▶️ get_payment_status()
>>    Check if the player has paid the deposit for this game.
>>
>>>**Parameters:**
>>>
>>>| Parameter | Type   | Required | Description                | Origin              |
>>>|-----------|--------|----------|----------------------------|---------------------|
>>>| `self`    | `Serializer` | Implicit | The serializer instance.   | DRF internal call |
>>>| `obj` | `Game` | Yes | The game object being serialized. | From queryset |
>>>
>>>**Return:**
>>>
>>>`string` with payment status (e.g., "paid", "pending").
>>>
>>>**Function Definition:**
>>>```python
>>># app_core/poker_event/serializers.py -> JoinedGameSerializer
>>>def get_payment_status(self, obj):
>>>    # Gets player from context, queries GameSessionDeposit, returns status or "pending"
>>>```
>
>#### 📃 PlayerJoiningSerializer
>>---
>>##### ▶️ get_joining_details()
>>    Retrieve all games the player has joined.
>>
>>>**Parameters:**
>>>
>>>| Parameter | Type   | Required | Description                | Origin              |
>>>|-----------|--------|----------|----------------------------|---------------------|
>>>| `self`    | `Serializer` | Implicit | The serializer instance.   | DRF internal call |
>>>| `obj` | `Player` | Yes | The player object being serialized. | From queryset |
>>>
>>>**Return:**
>>>
>>>Serialized list of games the player has joined using `JoinedGameSerializer`.
>>>
>>>**Function Definition:**
>>>```python
>>># app_core/poker_event/serializers.py -> PlayerJoiningSerializer
>>>def get_joining_details(self, obj):
>>>    # Filters Games based on player joining, serializes with JoinedGameSerializer
>>>```
>

## 📁 app_core/social/
### 📌 facebook.py
>
>---
>#### ▶️ post_to_facebook()
>>Under development   
>
### 📌 telegram.py
>
>---
>#### ▶️ post_to_telegram()
>>Under development   

## 📁 api/
### 📌 settings.py
>
>---
>#### ▶️ get_env_variable()
>>Under development   
>
>---

### 📌 views.py
>
>---
>#### ▶️ verify_telegram_user()
>    Handles the verification and authentication of a user based on Telegram initData and manages user registration or login.
>
>>**Parameters:**
>>
>>| Parameter | Type      | Required | Description                        | Origin                                  |
>>|-----------|-----------|----------|------------------------------------|-----------------------------------------|
>>| `request` | `Request` | Yes      | The incoming HTTP request object.  | Django rest framework (contains `initData`) |
>>
>>**Return:**
>>
>>`Response` object:
>>- HTTP 200: User exists, last login updated
>>- HTTP 201: New user created 
>>- HTTP 400: Missing data
>>- HTTP 401: Invalid authentication
>>
>>**Function Definition:**
>>```python
>># app_core/poker_event/views.py
>>@api_view(["POST"])
>>def verify_telegram_user(request):
>>    ...
>>    return Response(...)
>>```
>>
>> **Sample Call:**
>>```python
>># Called via HTTP POST request to the mapped URL
>>```
>>
>
>---
>#### ▶️ get_all_players()
>>Under development   
>
>---
>#### ▶️ createGame()
>>Under development   
>
>---
>#### ▶️ getAllGames()
>>Under development   
>
>---
>#### ▶️ joinGame()
>>Under development   
>
>---
>#### ▶️ getGameDetails()
>>Under development   
>
>---
>#### ▶️ get_hosting_details()
>>Under development   
>
>---
>#### ▶️ get_joining_details()
>>Under development   

## 📁 app_scheduler/
### 📌 jobs.py
>
>---
>#### ▶️ scheduled_job()
>>Under development   
>
>---
### 📌 apps.py
>
>---
>#### ▶️ ready()
>>Under development   
>
>---

## 📁 ./ (Root)
### 📌 manage.py
>
>---
>#### ▶️ main()
>>Under development   
>