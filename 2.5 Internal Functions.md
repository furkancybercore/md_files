# 🧩 Backend Internal Functions

This document lists all reusable internal functions in the Poker Backend application to prevent code duplication.

## 📁 app_core/poker_event/
### 📌 utils.py
>---
>>##### ▶️ validate_init_data()
>>    Validates the initData string passed from Telegram WebApp using HMAC-SHA256.
>>    *Note: Ensures the request originates from Telegram.*
>>
>>**Parameters:**
>>
>>| Parameter   | Type     | Required | Description                                             | Origin                                                           |
>>|-------------|----------|----------|---------------------------------------------------------|------------------------------------------------------------------|
>>| `init_data` | `string` | Yes      | Raw URL-encoded initData string from Telegram WebApp. | `request.data['initData']` in [`views.verify_telegram_user`](#️-verify_telegram_user) |
>>
>>**Return:**
>>
>>`boolean`: `True` if the data's hash matches the computed hash, `False` otherwise.
>>
>>**Function Definition:**
>>```python
>># app_core/poker_event/utils.py
>>def validate_init_data(init_data: str) -> bool:
>>    ...
>>    return hmac.compare_digest(computed_hash, hash_to_check)
>>```
>>
>> **Sample Call:**
>>```python
>># app_core/poker_event/views.py -> verify_telegram_user
>>if not validate_init_data(init_data):
>>    return Response(...)
>>```
>>
>---
### 📌 models.py
>---
>>##### ▶️  set_auth_key()
>>
>> Under development
>
>>##### ▶️  check_auth_key()
>>
>> Under development
>
>>##### ▶️  update_last_login()
>>
>>    Updates the `last_login` field of the Player instance to the current time.
>>
>>**Parameters:**
>>
>>| Parameter | Type     | Required | Description                        | Origin                                                     |
>>|-----------|----------|----------|------------------------------------|------------------------------------------------------------|
>>| `self`    | `Player` | Yes      | The Player instance to update.     | Called on a Player object instance. e.g., `player.update_last_login()` |
>>
>>**Return:**
>>
>>`None`
>>
>>**Function Definition:**
>>```python
>># app_core/poker_event/models.py
>>class Player(models.Model):
>>    # ... other fields ...
>>    def update_last_login(self):
>>```
>>
>> **Sample Call:**
>>```python
>># app_core/poker_event/views.py -> verify_telegram_user
>>player = Player.objects.get(telegram_id=telegram_id)
>>player.update_last_login()
>>```
>
### 📌 serializers.py
>
>>#### 📃 PlayerSerializer
>> *Currently no internal methods documented.*
>---
>>#### 📃 VerifyUserSerializer
>> Under development 
>---
>>#### 📃 AllPlayerSerializer
>> *Currently no internal methods documented.*
>>
>---
>>#### 📃 CreateGameSerializer
>>
>>>##### ▶️ create()
>>>Under development   
>>
>>>##### ▶️ schedule_future_game_sessions()
>>>Under development   
>>
>>>##### ▶️ get_repeat_count()
>>>Under development   
>>
>>>##### ▶️ get_next_date()
>>>Under development   
>>
>>>##### ▶️ post_to_social_media()
>>> Under development
>>
>---
>>#### 📃 AllGameSerializer
>>
>>>##### ▶️ get_host()
>>>Under development   
>>
>---
>>#### 📃 JoinGameSerializer
>>
>>>##### ▶️ create()
>>>Under development   
>>
>---
>>#### 📃 GameDetailSerializer
>>
>>>##### ▶️ get_player_count()
>>>Under development   
>>
>>>##### ▶️ get_players()
>>>Under development   
>>
>---
>>#### 📃 JoinedPlayerSerializer
>>
>>>##### ▶️ get_payment_status()
>>>Under development   
>>
>---
>>#### 📃 HostingGameSerializer
>>
>>>##### ▶️ get_players_joined()
>>>Under development   
>>
>---
>>#### 📃 JoinedGameSerializer
>>
>>>##### ▶️ get_player_count()
>>>Under development   
>>
>>>##### ▶️ get_payment_status()
>>>Under development   
>---
>>#### 📃 PlayerJoiningSerializer
>>
>>>##### ▶️ get_joining_details()
>>>Under development   
>>
### 📌 views.py
>
>>##### ▶️ verify_telegram_user()
>>    Handles the verification and authentication of a user based on Telegram initData and manages user registration or login.
>>
>>**Parameters:**
>>
>>| Parameter | Type      | Required | Description                        | Origin                                                                                                    |
>>|-----------|-----------|----------|------------------------------------|-----------------------------------------------------------------------------------------------------------|
>>| `request` | `Request` | Yes      | The incoming HTTP request object.  | [`POST /api/verify-telegram-user/`](2.1%20Backend%20API%20URL%20Schema#️-verify-and-authenticate-a-telegram-user) |
>>
>>**Return:**
>>
>>`Response` object:
>>- HTTP 200: User exists, last login updated
>>- HTTP 201: New user created 
>>- HTTP 400: Missing data
>>- HTTP 401: Invalid authentication
>>
>>**Function Definition:**
>>```python
>># app_core/poker_event/views.py
>>@api_view(["POST"])
>>def verify_telegram_user(request):
>>```
>>
>> **Sample Call:**
>>```python
>># Called via HTTP POST request to the mapped URL
>>```
>>
>---
>>##### ▶️ get_all_players()
>>    Returns a list of all registered players in the system.
>>
>>**Parameters:**
>>
>>| Parameter | Type      | Required | Description                       | Origin                                                                          |
>>|-----------|-----------|----------|-----------------------------------|---------------------------------------------------------------------------------|
>>| `request` | `Request` | Yes      | The incoming HTTP request object. | [`GET /api/players/`](2.1%20Backend%20API%20URL%20Schema#️-get-all-players) |
>>
>>**Return:**
>>
>>`Response` object:
>>- HTTP 200: List of all players with serialized data
>>
>>**Function Definition:**
>>```python
>># app_core/poker_event/views.py
>>@api_view(["GET"])
>>def get_all_players(request):
>>```
>>
>> **Sample Call:**
>>```python
>># Called via HTTP GET request to the mapped URL
>>```
>>
>---
>>##### ▶️ createGame()
>>    Creates a new game with specified configurations based on the request data.
>>
>>**Parameters:**
>>
>>| Parameter | Type      | Required | Description                       | Origin                                                                               |
>>|-----------|-----------|----------|-----------------------------------|--------------------------------------------------------------------------------------|
>>| `request` | `Request` | Yes      | The incoming HTTP request object with game configuration. | [`POST /api/games/create/`](2.1%20Backend%20API%20URL%20Schema#️-create-poker-game) |
>>
>>**Return:**
>>
>>`Response` object:
>>- HTTP 201: Game created successfully with game data
>>- HTTP 400: Invalid data provided
>>
>>**Function Definition:**
>>```python
>># app_core/poker_event/views.py
>>@api_view(["POST"])
>>def createGame(request):
>>```
>>
>> **Sample Call:**
>>```python
>># Called via HTTP POST request to the mapped URL
>>```
>>
>---
>>##### ▶️ getAllGames()
>>    Returns a list of all available games in the system.
>>
>>**Parameters:**
>>
>>| Parameter | Type      | Required | Description                       | Origin                                                                         |
>>|-----------|-----------|----------|-----------------------------------|--------------------------------------------------------------------------------|
>>| `request` | `Request` | Yes      | The incoming HTTP request object. | [`GET /api/games/`](2.1%20Backend%20API%20URL%20Schema#️-get-all-games) |
>>
>>**Return:**
>>
>>`Response` object:
>>- HTTP 200: List of all games with serialized data
>>
>>**Function Definition:**
>>```python
>># app_core/poker_event/views.py
>>@api_view(["GET"])
>>def getAllGames(request):
>>```
>>
>> **Sample Call:**
>>```python
>># Called via HTTP GET request to the mapped URL
>>```
>>
>---
>>##### ▶️ joinGame()
>>    Allows a player to join an existing game based on the request data.
>>
>>**Parameters:**
>>
>>| Parameter | Type      | Required | Description                       | Origin                                                                            |
>>|-----------|-----------|----------|-----------------------------------|-----------------------------------------------------------------------------------|
>>| `request` | `Request` | Yes      | The incoming HTTP request object with player and game information. | [`POST /api/game/join/`](2.1%20Backend%20API%20URL%20Schema#️-join-poker-game) |
>>
>>**Return:**
>>
>>`Response` object:
>>- HTTP 201: Player successfully joined the game
>>- HTTP 400: Invalid data provided
>>
>>**Function Definition:**
>>```python
>># app_core/poker_event/views.py
>>@api_view(["POST"])
>>def joinGame(request):
>>```
>>
>> **Sample Call:**
>>```python
>># Called via HTTP POST request to the mapped URL
>>```
>>
>---
>>##### ▶️ getGameDetails()
>>    Returns details of a specific game including player count and player information.
>>
>>**Parameters:**
>>
>>| Parameter | Type      | Required | Description                       | Origin                                                                                    |
>>|-----------|-----------|----------|-----------------------------------|-------------------------------------------------------------------------------------------|
>>| `request` | `Request` | Yes      | The incoming HTTP request object. | [`GET /api/games/{game_id}/`](2.1%20Backend%20API%20URL%20Schema#️-get-specific-game-details) |
>>| `game_id` | `int`     | Yes      | The ID of the game to retrieve.   | URL parameter                                                                             |
>>
>>**Return:**
>>
>>`Response` object:
>>- HTTP 200: Game details with serialized data
>>- HTTP 404: Game not found
>>
>>**Function Definition:**
>>```python
>># app_core/poker_event/views.py
>>@api_view(["GET"])
>>def getGameDetails(request, game_id):
>>```
>>
>> **Sample Call:**
>>```python
>># Called via HTTP GET request to the mapped URL with game_id
>>```
>>
>---
>>##### ▶️ get_hosting_details()
>>    Retrieves full game details for a player hosting games based on their Telegram ID.
>>
>>**Parameters:**
>>
>>| Parameter | Type      | Required | Description                       | Origin                                                                                            |
>>|-----------|-----------|----------|-----------------------------------|---------------------------------------------------------------------------------------------------|
>>| `request` | `Request` | Yes      | The incoming HTTP request object containing the player's telegram_id. | [`POST /api/hosting-details/`](2.1%20Backend%20API%20URL%20Schema#️-get-players-hosting-details) |
>>
>>**Return:**
>>
>>`Response` object:
>>- HTTP 200: Hosting details with serialized data
>>- HTTP 400: Missing Telegram ID
>>- HTTP 404: Player not found
>>
>>**Function Definition:**
>>```python
>># app_core/poker_event/views.py
>>@api_view(["POST"])
>>def get_hosting_details(request):
>>```
>>
>> **Sample Call:**
>>```python
>># Called via HTTP POST request to the mapped URL with telegram_id in the request body
>>```
>>
>---
>>##### ▶️ get_joining_details()
>>    Retrieves details of games a player has joined based on their Telegram ID.
>>
>>**Parameters:**
>>
>>| Parameter | Type      | Required | Description                       | Origin                                                                                          |
>>|-----------|-----------|----------|-----------------------------------|-------------------------------------------------------------------------------------------------|
>>| `request` | `Request` | Yes      | The incoming HTTP request object containing the player's telegram_id. | [`POST /api/joining-details/`](2.1%20Backend%20API%20URL%20Schema#️-get-players-joined-games) |
>>
>>**Return:**
>>
>>`Response` object:
>>- HTTP 200: Joining details with serialized data
>>- HTTP 400: Missing Telegram ID
>>- HTTP 404: Player not found
>>
>>**Function Definition:**
>>```python
>># app_core/poker_event/views.py
>>@api_view(["POST"])
>>def get_joining_details(request):
>>```
>>
>> **Sample Call:**
>>```python
>># Called via HTTP POST request to the mapped URL with telegram_id in the request body
>>```
>>
## 📁 app_core/social/
### 📌 facebook.py
>
>##### ▶️ post_to_facebook()
>Under development   
>
### 📌 telegram.py
>
>##### ▶️ post_to_telegram()
>Under development   
>

## 📁 app_scheduler/
### 📌 jobs.py
>
>>##### ▶️ generate_ai_content()
>>    Generates text content using the OpenAI API (gpt-4o-mini) based on a provided prompt. 
>>    Requires the `OPENAI_API_KEY` environment variable to be set either in the system environment or a `.env` file.
>>
>>**Parameters:**
>>
>>| Parameter | Type     | Required | Description                                             | Origin                           |
>>|-----------|----------|----------|---------------------------------------------------------|----------------------------------|
>>| `prompt`  | `string` | Yes      | The input text prompt to guide the AI content generation. | Passed when calling the function |
>>
>>**Return:**
>>
>>`string`: The generated text content from OpenAI, or an error message string if generation fails.
>>
>>**Function Definition:**
>>```python
>># app_scheduler/jobs.py
>>def generate_ai_content(prompt: str) -> str:
>>    return (..response text..)
>>```
>>
>> **Sample Call:**
>>```python
>># Example usage
>>from app_scheduler.jobs import generate_ai_content
>>
>>user_prompt = "Capital city of Australia?"
>>ai_response = generate_ai_content(user_prompt)
>>print(f"Generated Description: {ai_response}")
>>```
>>
>---
>>##### ▶️ scheduled_job()
>> *Currently no internal methods documented. Dummy function*  
>
### 📌 apps.py
>
>>##### ▶️ ready()
>>    Initializes and configures the APScheduler when the Django application starts.
>>    Sets up the background scheduler, adds the Django job store, and potentially schedules jobs.
>>
>>**Parameters:**
>>
>>| Parameter | Type   | Required | Description                       | Origin                                                              |
>>|-----------|--------|----------|-----------------------------------|---------------------------------------------------------------------|
>>| `self`    | `AppSchedulerConfig` | Yes      | The instance of the AppConfig class. | Called automatically by Django during app initialization. |
>>
>>**Return:**
>>
>>`None`
>>
>>**Function Definition:**
>>```python
>># app_scheduler/apps.py
>>class AppSchedulerConfig(AppConfig):
>>    # ... other config ...
>>    def ready(self):
>>        # ... scheduler setup ...
>>```
>>
>> **Sample Call:**
>>```python
>># Automatically called by Django on startup.
>>```

## 📁 ./ (Root)
### 📌 manage.py
>>##### ▶️ main()
>>    The main entry point for Django's command-line utility.
>>    Sets the default settings module environment variable and executes administrative tasks based on command-line arguments.
>>
>>**Parameters:**
>>
>> None (reads from `sys.argv`)
>>
>>**Return:**
>>
>>`None`
>>
>>**Function Definition:**
>>```python
>># manage.py
>>def main():
>>```
>>
>> **Sample Call:**
>>```bash
>>python manage.py runserver
>>python manage.py makemigrations
>># etc.
>>```
>