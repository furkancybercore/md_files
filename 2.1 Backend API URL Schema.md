# üéÆ Backend API URL Schema:

This document provides a comprehensive overview of the Poker Backend API, including available endpoints, request/response formats, and usage examples.

üí°The API enforces various validation rules to ensure data integrity. If validation fails, the API will return a `400 Bad Request` error with details about the failed validation.

# üìù Notes

### ‚åõ Endpoints Status
Endpoints are marked for their status
- ‚ú≥Ô∏è fully implemented and should just work
- ‚ú¥Ô∏è development in progress
- ‚õî not yet implemented but planned

### üîó Base URL
Base url for staging server:
```
https://staging-pokerebot-backend.onrender.com
```

Base url for production server:
```
https://pokerebot-backend-django.onrender.com
```

# üì° API Endpoints

## üìå Verify and Authentication API

- **`POST`  | Verify and Authenticate a Telegram User:** Verify and authenticate the user.

### ‚ú≥Ô∏è Verify and Authenticate a Telegram User

- Validates a Telegram user's `initData`.
- Confirms their identity.
- Updates their last login timestamp.
- Register the new user if it's not exist in our database.

**Endpoint:**
```
POST {{baseUrl}}/players/verify/
```

**Input Parameters:**
| Parameter | Location | Type | Required | Description |
| --- | --- | --- | --- | --- |
| `initData` | Headers | string | Yes | URL-encoded authentication data from Telegram ([docs](https://core.telegram.org/bots/webapps#validating-data-received-via-the-mini-app)). |

**Response Status Codes:**
- `200 OK`: User verified successfully.
- `201 Created`: User not exists but created successfully.
- `400 Bad Request`: Missing initData, Missing auth_date, or Missing user ID in initData.
- `401 Unauthorized`: Authentication failed, initData is invalid or has expired.

**Response Body:**
| Field | Type | Description |
| --- | --- | --- |
| `error` | string | Error message when request fails. |
| `exists` | boolean | Whether user exists in database (on success). |
| `created` | boolean | Whether user was created (on 201 status). |

**Example Usage:**
```
POST {{baseUrl}}/players/verify/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
N/A
```
```
// Response (200 OK)
{
    "exists": true
}
```
---

## üìå Player

### ‚ú≥Ô∏è Player Profile API

- **`GET`  | Get Current Player Details:** Retrieve the current authenticated Telegram player's details.
- **`PUT`  | Update Current Player Details:** Update specific fields for the authenticated player.

**Get Current Player Details**

- Retrieves details for the currently authenticated player based on `initData`.
- Requires `initData` in request headers.
- Authentication handled via `@require_telegram_self` decorator.

**Endpoint:**
```
GET {{baseUrl}}/players/me/
```

**Input Parameters:**
| Parameter  | Location | Type   | Required | Description |
|---|---|---|---|---|
| `initData` | Headers  | string | Yes      | URL-encoded authentication data from Telegram. |

**Response Status Codes:**
- `200 OK`: Player details returned successfully.
- `404 Not Found`: Player not found.
- `401 Unauthorized`: Invalid `initData`.

**Response Body:**
| Field | Type | Description |
| --- | --- | --- |
| `user_pk_id` | integer | Player's primary key ID. |
| `roles` | list | Player roles (`player`, `host`, `influencer`). |
| `telegram_id` | integer | Telegram user ID. |
| `first_name` | string | Player's first name. |
| `last_name` | string | Player's last name. |
| `photo_url` | string | URL of the player's profile photo. |
| `balance` | integer | Current balance in point system. |
| `win_points` | integer | Total points won. |
| `auth_key_hash` | string | Hashed authentication key (internal use). |
| `created_at` | string | Account creation timestamp (ISO 8601 format). |
| `last_login` | string | Most recent login timestamp (ISO 8601 format). |

**Example Usage:**
```
GET {{baseUrl}}/players/me/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
N/A
```
```
// Response (200 OK)
{
    "user_pk_id": 1,
    "roles": [
        "player"
    ],
    "telegram_id": 8123173403,
    "first_name": "Furkan-cybercore",
    "last_name": "",
    "photo_url": "https://t.me/i/userpic/320/....svg",
    "balance": 0,
    "win_points": 0,
    "auth_key_hash": "",
    "created_at": "2025-04-29T11:48:41.770377+10:00",
    "last_login": "2025-04-29T11:51:57.455098+10:00"
}
```
---

**Update Current Player Details**

- Updates details for the currently authenticated player.
- Requires `initData` in request headers.
- Update data (`put_data`) sent in the request body.
- Allows partial updates (only provided fields are updated).
- Authentication handled via `@require_telegram_self` decorator.

**Endpoint:**
```
PUT {{baseUrl}}/players/me/
```

**Input Parameters:**
| Parameter | Location | Type | Required | Description |
| --- | --- | --- | --- | --- |
| `initData` | Headers  | string | Yes      | URL-encoded authentication data from Telegram. |
| `put_data` | Body | object | Yes | JSON object containing player attributes to update. |

**Response Status Codes:**
- `200 OK`: Player details updated successfully.
- `400 Bad Request`: Invalid `put_data`.
- `401 Unauthorized`: Invalid `initData`.
- `404 Not Found`: Player not found.

**Response Body:**
| Field | Type | Description |
| --- | --- | --- |
| `user_pk_id` | integer | Player's primary key ID. |
| `roles` | list | Player roles. |
| `telegram_id` | integer | Telegram user ID. |
| `first_name` | string | Player's updated first name. |
| `last_name` | string | Player's updated last name. |
| `photo_url` | string | Player's updated photo URL. |
| `balance` | integer | Player's balance. |
| `win_points` | integer | Player's win points. |
| `auth_key_hash` | string | Hashed authentication key. |
| `created_at` | string | Account creation timestamp. |
| `last_login` | string | Most recent login timestamp. |

**Example Usage:**
```
PUT {{baseUrl}}/players/me/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
{
  "put_data": {
    "first_name": "Furkan",
    "last_name": "Cybercore"
  }
}
```
```
// Response (200 OK)
{
    "user_pk_id": 1,
    "roles": [
        "host",
        "influencer",
        "player"
    ],
    "telegram_id": 8123173403,
    "first_name": "Furkan",
    "last_name": "Cybercore",
    "photo_url": null,
    "balance": 0,
    "win_points": 0,
    "auth_key_hash": "",
    "created_at": "2025-04-29T12:01:51.132712+10:00",
    "last_login": "2025-04-29T12:01:51.135235+10:00"
}
```
---

### ‚ú≥Ô∏è Influencer Profile API

- **`POST` | Create Influencer Profile:** Create a new Influencer profile (only if not already an influencer).
- **`GET`  | Get Influencer Profile:** Retrieve the current authenticated player's Influencer profile.
- **`PUT`  | Update Influencer Profile:** Update fields in the existing Influencer profile.

**Create Influencer Profile**

- Creates an influencer profile for the authenticated user.
- Requires `initData` in request headers.
- Optional profile data (`facebook_id`, etc.) sent in the request body.
- User must *not* already have the `influencer` role.
- Adds the `influencer` role to the player upon successful creation.
- Authentication handled via `@require_telegram_self` decorator.

**Endpoint:**
```
POST {{baseUrl}}/influencers/me/
```

**Input Parameters:**
| Parameter | Location | Type | Required | Description |
| --- | --- | --- | --- | --- |
| `initData` | Headers | string | Yes | URL-encoded authentication data from Telegram. |
| `facebook_id` | Body | string | No | Facebook ID. |
| `instagram_id` | Body | string | No | Instagram ID. |
| `youtube_id` | Body | string | No | Youtube ID. |
| `threads_id` | Body | string | No | Threads ID. |

**Response Status Codes:**
- `200 OK`: Influencer profile created successfully.
- `400 Bad Request`: Influencer profile already exists or invalid data provided.
- `401 Unauthorized`: Invalid `initData`.
- `404 Not Found`: Player not found.

**Response Body:**
| Field | Type | Description |
| --- | --- | --- |
| `facebook_id` | string | Facebook ID. |
| `instagram_id` | string | Instagram ID. |
| `youtube_id` | string | Youtube ID. |
| `threads_id` | string | Threads ID. |
| `influencer_since` | string | Timestamp when the profile was created (ISO 8601 format). |

**Example Usage:**
```
POST {{baseUrl}}/influencers/me/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
{} 
```
```
// Response (200 OK)
{
    "facebook_id": null,
    "instagram_id": null,
    "youtube_id": null,
    "threads_id": null,
    "influencer_since": "2025-06-21T11:22:00+10:00"
}
```
---

**Get Influencer Profile**

- Retrieves the influencer profile for the authenticated user.
- Requires `initData` in request headers.
- User must have the `influencer` role.
- Authentication handled via `@require_telegram_self` decorator.

**Endpoint:**
```
GET {{baseUrl}}/influencers/me/
```

**Input Parameters:**
| Parameter  | Location | Type   | Required | Description |
|------------|----------|--------|----------|-------------|
| `initData` | Headers  | string | Yes      | URL-encoded authentication data from Telegram. |

**Response Status Codes:**
- `200 OK`: Influencer profile retrieved successfully.
- `401 Unauthorized`: Invalid `initData`.
- `404 Not Found`: Player or Influencer profile not found.

**Response Body:**
| Field | Type | Description |
| --- | --- | --- |
| `facebook_id` | string | Facebook ID. |
| `instagram_id` | string | Instagram ID. |
| `youtube_id` | string | Youtube ID. |
| `threads_id` | string | Threads ID. |
| `influencer_since` | string | Timestamp when the profile was created. |

**Example Usage:**
```
GET {{baseUrl}}/influencers/me/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
N/A
```
```
// Response (200 OK)
{
    "facebook_id": null,
    "instagram_id": null,
    "youtube_id": null,
    "threads_id": null,
    "influencer_since": "2025-06-21T11:22:00+10:00"
}
```
---

**Update Influencer Profile**

- Updates the influencer profile for the authenticated user.
- Requires `initData` in request headers.
- Update data (`facebook_id`, etc.) sent in the request body.
- Allows partial updates.
- User must have the `influencer` role.
- Authentication handled via `@require_telegram_self` decorator.

**Endpoint:**
```
PUT {{baseUrl}}/influencers/me/
```

**Input Parameters:**
| Parameter | Location | Type | Required | Description |
| --- | --- | --- | --- | --- |
| `initData` | Headers | string | Yes | URL-encoded authentication data from Telegram. |
| `facebook_id` | Body | string | No | New Facebook ID. |
| `instagram_id` | Body | string | No | New Instagram ID. |
| `youtube_id` | Body | string | No | New Youtube ID. |
| `threads_id` | Body | string | No | New Threads ID. |

**Response Status Codes:**
- `200 OK`: Influencer profile updated successfully.
- `400 Bad Request`: Invalid input parameters.
- `401 Unauthorized`: Invalid `initData`.
- `404 Not Found`: Player or Influencer profile not found.

**Response Body:**
| Field | Type | Description |
| --- | --- | --- |
| `facebook_id` | string | Updated Facebook ID. |
| `instagram_id` | string | Updated Instagram ID. |
| `youtube_id` | string | Updated Youtube ID. |
| `threads_id` | string | Updated Threads ID. |
| `influencer_since` | string | Timestamp when the profile was created. |

**Example Usage:**
```
PUT {{baseUrl}}/influencers/me/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
{
  "facebook_id": "myFacebook",
  "instagram_id": "ig_test_id"
}
```
```
// Response (200 OK)
{
    "facebook_id": "myFacebook",
    "instagram_id": "ig_test_id",
    "youtube_id": null,
    "threads_id": null,
    "influencer_since": "2025-06-21T11:22:00+10:00"
}
```
---

### ‚ú≥Ô∏è Host Profile API

- **`POST` | Create Host Profile:** Create a new Host profile (only if not already a host).
- **`GET`  | Get Host Profile:** Retrieve the current authenticated player's Host profile.
- **`PUT`  | Update Host Profile:** Update fields in the existing Host profile.

**Create Host Profile**

- Creates a host profile for the authenticated user.
- Requires `initData` in request headers.
- Profile data (`bio`) sent in the request body.
- User must *not* already have the `host` role.
- Adds the `host` role to the player upon successful creation.
- Authentication handled via `@require_telegram_self` decorator.

**Endpoint:**
```
POST {{baseUrl}}/hosts/me/
```

**Input Parameters:**
| Parameter | Location | Type | Required | Description |
| --- | --- | --- | --- | --- |
| `initData` | Headers | string | Yes | URL-encoded authentication data from Telegram. |
| `bio` | Body | string | No | Host bio (max 50 characters). |

**Response Status Codes:**
- `200 OK`: Host profile created successfully.
- `400 Bad Request`: Host profile already exists or invalid data provided.
- `401 Unauthorized`: Invalid `initData`.
- `404 Not Found`: Player not found.

**Response Body:**
| Field | Type | Description |
| --- | --- | --- |
| `bio` | string | Host's bio. |
| `total_games_hosted` | integer | Number of games hosted by this player (starts at 0). |

**Example Usage:**
```
POST {{baseUrl}}/hosts/me/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
N/A
```
```
// Response (200 OK)
{
    "bio": "",
    "total_games_hosted": 0
}
```
---

**Get Host Profile**

- Retrieves the host profile for the authenticated user.
- Requires `initData` in request headers.
- User must have the `host` role.
- Authentication handled via `@require_telegram_self` decorator.

**Endpoint:**
```
GET {{baseUrl}}/hosts/me/
```

**Input Parameters:**
| Parameter  | Location | Type   | Required | Description |
|------------|----------|--------|----------|-------------|
| `initData` | Headers  | string | Yes      | URL-encoded authentication data from Telegram. |

**Response Status Codes:**
- `200 OK`: Host profile retrieved successfully.
- `401 Unauthorized`: Invalid `initData`.
- `404 Not Found`: Player or Host profile not found.

**Response Body:**
| Field | Type | Description |
| --- | --- | --- |
| `bio` | string | Host's bio. |
| `total_games_hosted` | integer | Number of games hosted by this player. |

**Example Usage:**
```
GET {{baseUrl}}/hosts/me/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
N/A
```
```
// Response (200 OK)
{
    "bio": "",
    "total_games_hosted": 0
}
```
---

**Update Host Profile**

- Updates the host profile for the authenticated user.
- Requires `initData` in request headers.
- Update data (`bio`) sent in the request body.
- Allows partial updates.
- User must have the `host` role.
- Authentication handled via `@require_telegram_self` decorator.

**Endpoint:**
```
PUT {{baseUrl}}/hosts/me/
```

**Input Parameters:**
| Parameter | Location | Type | Required | Description |
| --- | --- | --- | --- | --- |
| `initData` | Headers | string | Yes | URL-encoded authentication data from Telegram. |
| `bio` | Body | string | No | New bio for the host (max 50 characters). |

**Response Status Codes:**
- `200 OK`: Host profile updated successfully.
- `400 Bad Request`: Invalid input parameters.
- `401 Unauthorized`: Invalid `initData`.
- `404 Not Found`: Player or Host profile not found.

**Response Body:**
| Field | Type | Description |
| --- | --- | --- |
| `bio` | string | Updated host's bio. |
| `total_games_hosted` | integer | Number of games hosted by this player. |

**Example Usage:**
```
PUT {{baseUrl}}/hosts/me/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
{
  "bio": "Updated bio - Host of Friday night games!"
}
```
```
// Response (200 OK)
{
    "bio": "Updated bio - Host of Friday night games!",
    "total_games_hosted": 0
}
```
---

## üìå Game & Session Management API

### ‚ú≥Ô∏è Host Game API

- **`POST` | Create Game:** Create a new game.
- **`GET` | List Host's Games:** List all games hosted by the user.
- **`GET` | Get Specific Host Game:** Get details of a specific game hosted by the user.
- **`PUT` | Update Game:** Update details of a specific game hosted by the user.

**Create Game**

- Creates a new poker game instance.
- Requires `initData` in request headers.
- Game data sent in the request body.
- Requires the user to have the **Host** role.
- Automatically creates the first `GameSession` based on `start_datetime` and `recurrence`.
- Authentication handled via `@require_telegram_self` and `@require_host` decorators.

**Endpoint:**
```
POST {{baseUrl}}/host/game/
```

**Input Parameters:**
| Parameter        | Location | Type                 | Required | Description |
|------------------|----------|----------------------|----------|-------------|
| `initData`       | Headers  | string               | Yes      | URL-encoded authentication data from Telegram. |
| `title`          | Body     | string               | Yes      | Name of the poker game (max 255 chars). |
| `days_of_week`   | Body     | list[integer]        | Yes      | Days for recurrence (0=Mon, 6=Sun). Required if recurrence is "weekly" or "fortnightly". |
| `start_datetime` | Body     | string               | Yes      | Date and time when the first game session starts (ISO 8601 format, e.g., "2025-06-30T19:30:00+10:00"). |
| `small_blind`    | Body     | integer              | Yes      | Small blind amount. |
| `big_blind`      | Body     | integer              | Yes      | Big blind amount. |
| `min_buy_in`     | Body     | integer              | Yes      | Minimum buy-in amount. |
| `max_buy_in`     | Body     | integer              | Yes      | Maximum buy-in amount. |
| `max_players`    | Body     | integer              | Yes      | Maximum number of players allowed. |
| `recurrence`     | Body     | string               | No       | Game frequency ("once", "daily", "weekly", "fortnightly", "monthly"). |
| `location`       | Body     | string               | No       | Physical location of the game (max 255 chars). |
| `duration`       | Body     | string               | No       | Expected duration (e.g., "08:00:00"). Default: 8 hours. |
| `notes`          | Body     | string               | No       | Optional remarks from the host. |
| `required_deposit`| Body    | integer              | No       | Minimum deposit required to join. |
| `straddle`       | Body     | integer              | No       | Optional straddle amount. |


**Response Status Codes:**
- `201 Created`: Game and first session created successfully.
- `400 Bad Request`: Invalid input parameters.
- `401 Unauthorized`: Authentication failed (invalid `initData`).
- `403 Forbidden`: User does not have the Host role.
- `404 Not Found`: Player (Host) not found.

**Response Body:**
| Field | Type | Description |
| --- | --- | --- |
| `id` | integer | The ID of the newly created game. |
| `days_of_week` | list[integer] | Days for recurrence (if applicable). |
| `title` | string | Name of the game. |
| `recurrence` | string | Game frequency. |
| `start_datetime` | string | Start date/time of the first session. |
| `location` | string | Game location. |
| `duration` | string | Game duration. |
| `notes` | string | Host notes. |
| `required_deposit` | integer | Required deposit amount. |
| `small_blind` | integer | Small blind amount. |
| `big_blind` | integer | Big blind amount. |
| `straddle` | integer | Straddle amount. |
| `min_buy_in` | integer | Minimum buy-in. |
| `max_buy_in` | integer | Maximum buy-in. |
| `max_players` | integer | Maximum player capacity. |
| `created_at` | string | Timestamp when the game was created. |
| `host` | integer | The primary key ID of the HostProfile. |

**Example Usage:**
```
POST {{baseUrl}}/host/game/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
{
  "title": "Friday Poker Night",
  "days_of_week": [4],
  "start_datetime": "2025-07-04T19:00:00+10:00",
  "small_blind": 5,
  "big_blind": 10,
  "min_buy_in": 100,
  "max_buy_in": 500,
  "max_players": 9
}
```
```
// Response (201 Created)
{
    "id": 4,
    "days_of_week": [
        4
    ],
    "title": "Friday Poker Night",
    "recurrence": "once",
    "start_datetime": "2025-07-04T19:00:00+10:00",
    "location": "",
    "duration": "08:00:00",
    "notes": null,
    "required_deposit": null,
    "small_blind": 5,
    "big_blind": 10,
    "straddle": null,
    "min_buy_in": 100,
    "max_buy_in": 500,
    "max_players": 9,
    "created_at": "2025-04-29T12:26:51.309898+10:00",
    "host": 1
}
```
---

**List Host's Games**

- Lists all games created by the authenticated host.
- Requires `initData` in request headers.
- Requires the user to have the **Host** role.
- Authentication handled via `@require_telegram_self` and `@require_host` decorators.

**Endpoint:**
```
GET {{baseUrl}}/host/game/
```

**Input Parameters:**
| Parameter  | Location | Type   | Required | Description |
|------------|----------|--------|----------|-------------|
| `initData` | Headers  | string | Yes      | URL-encoded authentication data from Telegram. |

**Response Status Codes:**
- `200 OK`: Games listed successfully.
- `401 Unauthorized`: Authentication failed.
- `403 Forbidden`: User is not a Host.
- `404 Not Found`: Player (Host) not found.

**Response Body:**
- Array of full `Game` objects (see Create Game response body for fields) 
- Hosted by the player, 
- Ordered by descending `created_at`.

**Example Usage:**
```
GET {{baseUrl}}/host/game/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
N/A
```
```
// Response (200 OK)
[
    {
        "id": 4,
        "days_of_week": [
            4
        ],
        "title": "Friday Poker Night",
        "recurrence": "once",
        "start_datetime": "2025-07-04T19:00:00+10:00",
        "location": "",
        "duration": "08:00:00",
        "notes": null,
        "required_deposit": null,
        "small_blind": 5,
        "big_blind": 10,
        "straddle": null,
        "min_buy_in": 100,
        "max_buy_in": 500,
        "max_players": 9,
        "created_at": "2025-04-29T12:26:51.309898+10:00",
        "host": 1
    },
    {
        "id": 3,
        "days_of_week": [
            4
        ],
        "title": "Poker Night",
        "recurrence": "once",
        "start_datetime": "2025-07-04T19:00:00+10:00",
        "location": "",
        "duration": "08:00:00",
        "notes": null,
        "required_deposit": null,
        "small_blind": 5,
        "big_blind": 10,
        "straddle": null,
        "min_buy_in": 100,
        "max_buy_in": 500,
        "max_players": 9,
        "created_at": "2025-04-29T12:22:24.741707+10:00",
        "host": 1
    }
]
```
---

**Get Specific Host Game**

- Retrieves details of a specific game owned by the authenticated host.
- Requires `initData` in request headers.
- Path parameter `game_id` specifies the game.
- Requires the user to have the **Host** role and own the game.
- Authentication handled via `@require_telegram_self` and `@require_host` decorators.

**Endpoint:**
```
GET {{baseUrl}}/host/game/{game_id}/
```

**Input Parameters:**
| Parameter  | Location | Type    | Required | Description |
|------------|----------|---------|----------|-------------|
| `initData` | Headers  | string  | Yes      | URL-encoded authentication data from Telegram. |
| `game_id`  | Path     | integer | Yes      | ID of the game to retrieve. |

**Response Status Codes:**
- `200 OK`: Game details retrieved successfully.
- `401 Unauthorized`: Authentication failed.
- `403 Forbidden`: User is not the host of this game.
- `404 Not Found`: Player (Host) or Game not found.

**Response Body:**
- Full `Game` object (see Create Game response body for fields).

**Example Usage:**
```
GET {{baseUrl}}/host/game/4/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
N/A
```
```
// Response (200 OK)
{
    "id": 4,
    "days_of_week": [
        4
    ],
    "title": "Friday Poker Night",
    "recurrence": "once",
    "start_datetime": "2025-07-04T19:00:00+10:00",
    "location": "",
    "duration": "08:00:00",
    "notes": null,
    "required_deposit": null,
    "small_blind": 5,
    "big_blind": 10,
    "straddle": null,
    "min_buy_in": 100,
    "max_buy_in": 500,
    "max_players": 9,
    "created_at": "2025-04-29T12:26:51.309898+10:00",
    "host": 1
}
```
---

**Update Game**

- Updates details of a specific game owned by the authenticated host.
- Requires `initData` in request headers.
- Path parameter `game_id` specifies the game.
- Update data sent in the request body.
- Requires the user to have the **Host** role and own the game.
- Allows partial updates.
- Authentication handled via `@require_telegram_self` and `@require_host` decorators.

**Endpoint:**
```
PUT {{baseUrl}}/host/game/{game_id}/
```

**Input Parameters:**
| Parameter        | Location | Type                 | Required | Description |
|------------------|----------|----------------------|----------|-------------|
| `initData`       | Headers  | string               | Yes      | URL-encoded authentication data from Telegram. |
| `game_id`        | Path     | integer              | Yes      | ID of the game to update. |
| `title`          | Body     | string               | No       | New name of the poker game. |
| `recurrence`     | Body     | string               | No       | New game frequency. |
| `days_of_week`   | Body     | list[integer]        | No       | New days for recurrence. |
| `start_datetime` | Body     | string               | No       | New start date/time (affects future sessions). |
| `location`       | Body     | string               | No       | New physical location. |
| `duration`       | Body     | string               | No       | New expected duration. |
| `notes`          | Body     | string               | No       | New optional remarks. |
| `required_deposit`| Body    | integer              | No       | New minimum deposit required. |
| `small_blind`    | Body     | integer              | No       | New small blind amount. |
| `big_blind`      | Body     | integer              | No       | New big blind amount. |
| `straddle`       | Body     | integer              | No       | New optional straddle amount. |
| `min_buy_in`     | Body     | integer              | No       | New minimum buy-in amount. |
| `max_buy_in`     | Body     | integer              | No       | New maximum buy-in amount. |
| `max_players`    | Body     | integer              | No       | New maximum number of players. |

**Response Status Codes:**
- `200 OK`: Game updated successfully.
- `400 Bad Request`: Invalid input data.
- `401 Unauthorized`: Authentication failed.
- `403 Forbidden`: User is not the host of this game.
- `404 Not Found`: Player (Host) or Game not found.

**Response Body:**
- Updated full `Game` object (see Create Game response body for fields).

**Example Usage (Partial Update):**
```
PUT {{baseUrl}}/host/game/4/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
{
  "title": "Updated Friday Poker Night",
  "location": "New Location"
}
```
```
// Response (200 OK)
{
    "id": 4,
    "days_of_week": [
        4
    ],
    "title": "Updated Friday Poker Night",
    "recurrence": "once",
    "start_datetime": "2025-07-04T19:00:00+10:00",
    "location": "New Location",
    "duration": "08:00:00",
    "notes": null,
    "required_deposit": null,
    "small_blind": 5,
    "big_blind": 10,
    "straddle": null,
    "min_buy_in": 100,
    "max_buy_in": 500,
    "max_players": 9,
    "created_at": "2025-04-29T12:26:51.309898+10:00",
    "host": 1
}
```
---

### ‚ú≥Ô∏è Player Game API

- **`GET` | List Games:** List all available games (simplified view).
- **`GET` | Get Specific Game Details:** Get details of a specific game (simplified view).

**List Games**

- Lists all available games visible to players.
- Requires `initData` in request headers.
- Returns a simplified view of game details.
- Authentication handled via `@require_telegram_self` decorator.

**Endpoint:**
```
GET {{baseUrl}}/game/
```

**Input Parameters:**
| Parameter  | Location | Type   | Required | Description |
|------------|----------|--------|----------|-------------|
| `initData` | Headers  | string | Yes      | URL-encoded authentication data from Telegram. |

**Response Status Codes:**
- `200 OK`: Games listed successfully.
- `401 Unauthorized`: Authentication failed.
- `404 Not Found`: Player not found.

**Response Body:**
Array of simplified `Game` objects.
| Field | Type | Description |
| --- | --- | --- |
| `id` | integer | Game ID. |
| `title` | string | Name of the game. |
| `recurrence` | string | Game frequency. |
| `days_of_week` | list[integer] | Days for recurrence. |
| `start_datetime` | string | Start date/time of the first session. |
| `location` | string | Game location. |
| `duration` | string | Game duration. |
| `notes` | string | Host notes. |
| `required_deposit` | integer | Required deposit amount. |
| `small_blind` | integer | Small blind amount. |
| `big_blind` | integer | Big blind amount. |
| `straddle` | integer | Straddle amount. |
| `min_buy_in` | integer | Minimum buy-in. |
| `max_buy_in` | integer | Maximum buy-in. |
| `max_players` | integer | Maximum player capacity. |

**Example Usage:**
```
GET {{baseUrl}}/game/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
N/A
```
```
// Response (200 OK)
[
      {
        "id": 3,
        "title": "Poker Night",
        "recurrence": "once",
        "days_of_week": [
            4
        ],
        "start_datetime": "2025-07-04T19:00:00+10:00",
        "location": "",
        "duration": "08:00:00",
        "notes": null,
        "required_deposit": null,
        "small_blind": 5,
        "big_blind": 10,
        "straddle": null,
        "min_buy_in": 100,
        "max_buy_in": 500,
        "max_players": 9
    },
    {
        "id": 4,
        "title": "Updated Friday Poker Night",
        "recurrence": "once",
        "days_of_week": [
            4
        ],
        "start_datetime": "2025-07-04T19:00:00+10:00",
        "location": "New Location",
        "duration": "08:00:00",
        "notes": null,
        "required_deposit": null,
        "small_blind": 5,
        "big_blind": 10,
        "straddle": null,
        "min_buy_in": 100,
        "max_buy_in": 500,
        "max_players": 9
    }
]
```
---

**Get Specific Game Details**

- Retrieves simplified details of a specific game visible to players.
- Requires `initData` in request headers.
- Path parameter `game_id` specifies the game.
- Authentication handled via `@require_telegram_self` decorator.

**Endpoint:**
```
GET {{baseUrl}}/game/{game_id}/
```

**Input Parameters:**
| Parameter  | Location | Type    | Required | Description |
|------------|----------|---------|----------|-------------|
| `initData` | Headers  | string  | Yes      | URL-encoded authentication data from Telegram. |
| `game_id`  | Path     | integer | Yes      | ID of the game to retrieve. |

**Response Status Codes:**
- `200 OK`: Game details retrieved successfully.
- `401 Unauthorized`: Authentication failed.
- `404 Not Found`: Player or Game not found.

**Response Body:**
Simplified `Game` object (see List Games response body for fields).

**Example Usage:**
```
GET {{baseUrl}}/game/4/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
N/A
```
```
// Response (200 OK)
{
    "id": 4,
    "title": "Updated Friday Poker Night",
    "recurrence": "once",
    "days_of_week": [
        4
    ],
    "start_datetime": "2025-07-04T19:00:00+10:00",
    "location": "New Location",
    "duration": "08:00:00",
    "notes": null,
    "required_deposit": null,
    "small_blind": 5,
    "big_blind": 10,
    "straddle": null,
    "min_buy_in": 100,
    "max_buy_in": 500,
    "max_players": 9
}
```
---

### ‚ú≥Ô∏è Host Session API

- **`GET` | List Sessions:** List sessions hosted by the user.
- **`GET` | Get Specific Host Session:** Get details of a specific session hosted by the user.
- **`PUT` | Update Session:** Update details of a specific session hosted by the user.

**List Sessions**

- Lists all game sessions associated with games hosted by the authenticated user.
- Requires `initData` in request headers.
- Requires the user to have the **Host** role.
- Sessions are ordered by descending `start_datetime`.
- Authentication handled via `@require_telegram_self` and `@require_host` decorators.

**Endpoint:**
```
GET {{baseUrl}}/host/session/
```

**Input Parameters:**
| Parameter  | Location | Type   | Required | Description |
|------------|----------|--------|----------|-------------|
| `initData` | Headers  | string | Yes      | URL-encoded authentication data from Telegram. |

**Response Status Codes:**
- `200 OK`: Sessions listed successfully.
- `401 Unauthorized`: Authentication failed.
- `403 Forbidden`: User is not a Host.
- `404 Not Found`: Player (Host) not found or no sessions found for their games.

**Response Body:**
Array of `GameSession` objects.
| Field | Type | Description |
| --- | --- | --- |
| `id` | integer | Session ID. |
| `game_title` | string | Title of the parent Game. |
| `start_datetime` | string | Start date/time of the session. |
| `end_datetime` | string | End date/time of the session (null if not ended). |
| `is_cancelled` | boolean | Whether the session is cancelled. |
| `is_completed` | boolean | Whether the session is completed. |
| `num_players_checked_in` | integer | Number of players currently checked into the session. |
| `created_at` | string | Timestamp when the session was created. |
| `small_blind` | integer | Small blind for this session (may differ from game default). |
| `big_blind` | integer | Big blind for this session. |
| `straddle` | integer | Straddle for this session. |
| `min_buy_in` | integer | Minimum buy-in for this session. |
| `max_buy_in` | integer | Maximum buy-in for this session. |
| `max_players` | integer | Maximum player capacity for this session. |
| `game` | integer | ID of the parent Game. |

**Example Usage:**
```
GET {{baseUrl}}/host/session/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
N/A
```
```
// Response (200 OK)
[
      {
        "id": 3,
        "game_title": "Poker Night",
        "start_datetime": "2025-07-04T19:00:00+10:00",
        "end_datetime": null,
        "is_cancelled": false,
        "is_completed": false,
        "num_players_checked_in": 0,
        "created_at": "2025-04-29T12:22:24.744347+10:00",
        "small_blind": 5,
        "big_blind": 10,
        "straddle": null,
        "min_buy_in": 100,
        "max_buy_in": 500,
        "max_players": 9,
        "game": 3
    },
    {
        "id": 4,
        "game_title": "Updated Friday Poker Night",
        "start_datetime": "2025-07-04T19:00:00+10:00",
        "end_datetime": null,
        "is_cancelled": false,
        "is_completed": false,
        "num_players_checked_in": 0,
        "created_at": "2025-04-29T12:26:51.312944+10:00",
        "small_blind": 5,
        "big_blind": 10,
        "straddle": null,
        "min_buy_in": 100,
        "max_buy_in": 500,
        "max_players": 9,
        "game": 4
    }
]
```
---

**Get Specific Host Session**

- Retrieves details of a specific game session associated with a game hosted by the authenticated user.
- Requires `initData` in request headers.
- Path parameter `session_id` specifies the session.
- Requires the user to have the **Host** role and own the parent game.
- Authentication handled via `@require_telegram_self` and `@require_host` decorators.

**Endpoint:**
```
GET {{baseUrl}}/host/session/{session_id}/
```

**Input Parameters:**
| Parameter    | Location | Type    | Required | Description |
|--------------|----------|---------|----------|-------------|
| `initData`   | Headers  | string  | Yes      | URL-encoded authentication data from Telegram. |
| `session_id` | Path     | integer | Yes      | ID of the session to retrieve. |

**Response Status Codes:**
- `200 OK`: Session details retrieved successfully.
- `401 Unauthorized`: Authentication failed.
- `403 Forbidden`: User is not the host of the game for this session.
- `404 Not Found`: Player (Host) or Session not found.

**Response Body:**
Full `GameSession` object (see List Sessions response body for fields).

**Example Usage:**
```
GET {{baseUrl}}/host/session/4/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
N/A
```
```
// Response (200 OK)
{
    "id": 4,
    "game_title": "Updated Friday Poker Night",
    "start_datetime": "2025-07-04T19:00:00+10:00",
    "end_datetime": null,
    "is_cancelled": false,
    "is_completed": false,
    "num_players_checked_in": 0,
    "created_at": "2025-04-29T12:26:51.312944+10:00",
    "small_blind": 5,
    "big_blind": 10,
    "straddle": null,
    "min_buy_in": 100,
    "max_buy_in": 500,
    "max_players": 9,
    "game": 4
}
```
---

**Update Session**

- Updates details of a specific game session associated with a game hosted by the authenticated user.
- Requires `initData` in request headers.
- Path parameter `session_id` specifies the session.
- Update data sent in the request body.
- Allows partial updates.
- Requires the user to have the **Host** role and own the parent game.
- Authentication handled via `@require_telegram_self` and `@require_host` decorators.

**Endpoint:**
```
PUT {{baseUrl}}/host/session/{session_id}/
```

**Input Parameters:**
| Parameter              | Location | Type    | Required | Description |
|------------------------|----------|---------|----------|-------------|
| `initData`             | Headers  | string  | Yes      | URL-encoded authentication data from Telegram. |
| `session_id`           | Path     | integer | Yes      | ID of the session to update. |
| `start_datetime`       | Body     | string  | No       | New start date/time (ISO 8601 format). |
| `end_datetime`         | Body     | string  | No       | New end date/time (ISO 8601 format). |
| `is_cancelled`         | Body     | boolean | No       | Mark session as cancelled. |
| `is_completed`         | Body     | boolean | No       | Mark session as completed. |
| `small_blind`          | Body     | integer | No       | Override game's small blind for this session. |
| `big_blind`            | Body     | integer | No       | Override game's big blind for this session. |
| `straddle`             | Body     | integer | No       | Override game's straddle for this session. |
| `min_buy_in`           | Body     | integer | No       | Override game's min buy-in for this session. |
| `max_buy_in`           | Body     | integer | No       | Override game's max buy-in for this session. |
| `max_players`          | Body     | integer | No       | Override game's max players for this session. |

**Response Status Codes:**
- `200 OK`: Session updated successfully.
- `400 Bad Request`: Invalid input data.
- `401 Unauthorized`: Authentication failed.
- `403 Forbidden`: User is not the host of the game for this session.
- `404 Not Found`: Player (Host) or Session not found.

**Response Body:**
Updated full `GameSession` object (see List Sessions response body for fields).

**Example Usage (Mark as Cancelled):**
```
PUT {{baseUrl}}/host/session/4/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
{
  "is_cancelled": true
}
```
```
// Response (200 OK)
{
    "id": 4,
    "game_title": "Updated Friday Poker Night",
    "start_datetime": "2025-07-04T19:00:00+10:00",
    "end_datetime": null,
    "is_cancelled": true,
    "is_completed": false,
    "num_players_checked_in": 0,
    "created_at": "2025-04-29T12:26:51.312944+10:00",
    "small_blind": 5,
    "big_blind": 10,
    "straddle": null,
    "min_buy_in": 100,
    "max_buy_in": 500,
    "max_players": 9,
    "game": 4
}
```
---

### ‚ú≥Ô∏è Player Session API

- **`GET`  | List Sessions:** List all available sessions (simplified view).
- **`GET`  | List Sessions for a Specific Game:** List sessions for a specific game (simplified view).
- **`GET`  | Get Specific Session Details:** Get details of a specific session (simplified view).
- **`POST` | Join a Session:** Allows a player to join a specific game session.
- **`POST` | Unjoin a Session:** Allows a player to leave a specific game session.

**List Sessions**

- Lists all available game sessions visible to players.
- Can optionally filter by `game_id` using a query parameter.
- Requires `initData` in request headers.
- Returns a simplified view of session details.
- Sessions are ordered by descending `start_datetime`.
- Authentication handled via `@require_telegram_self` decorator.

**Endpoint:**
```
GET {{baseUrl}}/session/
```
or
```
GET {{baseUrl}}/session/?game_id={game_id}
```

**Input Parameters:**
| Parameter  | Location | Type    | Required | Description |
|------------|----------|---------|----------|-------------|
| `initData` | Headers  | string  | Yes      | URL-encoded authentication data from Telegram. |
| `game_id`  | Query    | integer | No       | Optional ID of the game to filter sessions for. |

**Response Status Codes:**
- `200 OK`: Sessions listed successfully.
- `401 Unauthorized`: Authentication failed.
- `404 Not Found`: Player not found (or Game not found if `game_id` provided).

**Response Body:**
Array of simplified `GameSession` objects.
| Field | Type | Description |
| --- | --- | --- |
| `id` | integer | Session ID. |
| `start_datetime` | string | Start date/time of the session. |
| `end_datetime` | string | End date/time of the session. |
| `is_cancelled` | boolean | Whether the session is cancelled. |
| `is_completed` | boolean | Whether the session is completed. |
| `small_blind` | integer | Small blind for this session. |
| `big_blind` | integer | Big blind for this session. |
| `straddle` | integer | Straddle for this session. |
| `min_buy_in` | integer | Minimum buy-in for this session. |
| `max_buy_in` | integer | Maximum buy-in for this session. |
| `max_players` | integer | Maximum player capacity for this session. |
| `game` | integer | ID of the parent Game. |

**Example Usage (List Sessions for Game 4):**
```
GET {{baseUrl}}/session/?game_id=4
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
N/A
```
```
// Response (200 OK)
[
    {
        "id": 4,
        "start_datetime": "2025-07-04T19:00:00+10:00",
        "end_datetime": null,
        "is_cancelled": true,
        "is_completed": false,
        "small_blind": 5,
        "big_blind": 10,
        "straddle": null,
        "min_buy_in": 100,
        "max_buy_in": 500,
        "max_players": 9,
        "game": 4
    }
]
```
---

**Example Usage (List All Game):**
```
GET {{baseUrl}}/session/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
N/A
```
```
// Response (200 OK)
[
    {
        "id": 3,
        "start_datetime": "2025-07-04T19:00:00+10:00",
        "end_datetime": null,
        "is_cancelled": false,
        "is_completed": false,
        "small_blind": 5,
        "big_blind": 10,
        "straddle": null,
        "min_buy_in": 100,
        "max_buy_in": 500,
        "max_players": 9,
        "game": 3
    },
    {
        "id": 4,
        "start_datetime": "2025-07-04T19:00:00+10:00",
        "end_datetime": null,
        "is_cancelled": true,
        "is_completed": false,
        "small_blind": 5,
        "big_blind": 10,
        "straddle": null,
        "min_buy_in": 100,
        "max_buy_in": 500,
        "max_players": 9,
        "game": 4
    }
]
```
---

**Get Specific Session Details**

- Retrieves simplified details of a specific game session visible to players.
- Requires `initData` in request headers.
- Path parameter `session_id` specifies the session.
- Authentication handled via `@require_telegram_self` decorator.

**Endpoint:**
```
GET {{baseUrl}}/session/{session_id}/
```

**Input Parameters:**
| Parameter    | Location | Type    | Required | Description |
|--------------|----------|---------|----------|-------------|
| `initData`   | Headers  | string  | Yes      | URL-encoded authentication data from Telegram. |
| `session_id` | Path     | integer | Yes      | ID of the session to retrieve. |

**Response Status Codes:**
- `200 OK`: Session details retrieved successfully.
- `401 Unauthorized`: Authentication failed.
- `404 Not Found`: Player or Session not found.

**Response Body:**
Simplified `GameSession` object (see List Sessions response body for fields).

**Example Usage:**
```
GET {{baseUrl}}/session/4/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```
// Request Body
N/A
```
```
// Response (200 OK)
{
    "id": 4,
    "start_datetime": "2025-07-04T19:00:00+10:00",
    "end_datetime": null,
    "is_cancelled": true,
    "is_completed": false,
    "small_blind": 5,
    "big_blind": 10,
    "straddle": null,
    "min_buy_in": 100,
    "max_buy_in": 500,
    "max_players": 9,
    "game": 4
}
```
---

**Join a Session**

- Allows a player to join a specific game session.
- Requires `initData` in headers.

**Endpoint:**
```
POST {{baseUrl}}/session/join/{session_id}/
```

**Input Parameters:**
| Parameter    | Location | Type    | Required | Description                                        |
|--------------|----------|---------|----------|----------------------------------------------------|
| `initData`   | Headers  | string  | Yes      | URL-encoded authentication data from Telegram.     |
| `session_id` | Path     | integer | Yes      | ID of the session to join.                         |

**Response Status Codes:**
- `200 OK`: Joined successfully or already joined.
- `404 Not Found`: Session not found or Player not found.

**Response Body:**
| Field     | Type   | Description                                |
|-----------|--------|--------------------------------------------|
| `message` | string | "Joined successfully" or "Already joined". |

**Example Usage:**
```
POST {{baseUrl}}/session/join/1/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```on
// Response (200 OK)
{
    "message": "Joined successfully"
}
```
---

**Unjoin a Session**

- Allows a player to leave a specific game session.
- Requires `initData` in headers.

**Endpoint:**
```
POST {{baseUrl}}/session/unjoin/{session_id}/
```

**Input Parameters:**
| Parameter    | Location | Type    | Required | Description                                        |
|--------------|----------|---------|----------|----------------------------------------------------|
| `initData`   | Headers  | string  | Yes      | URL-encoded authentication data from Telegram.     |
| `session_id` | Path     | integer | Yes      | ID of the session to unjoin.                       |

**Response Status Codes:**
- `200 OK`: Unjoined successfully or not in session.
- `404 Not Found`: Session not found or Player not found.

**Response Body:**
| Field     | Type   | Description                                               |
|-----------|--------|-----------------------------------------------------------|
| `message` | string | "Unjoined successfully" or "You are not in this session". |

**Example Usage:**
```
POST {{baseUrl}}/session/unjoin/1/
```
```
// Request Headers
| Header   | Value              |
|----------|--------------------|
| initData | user=%7B%22id%2... |
```
```on
// Response (200 OK)
{
    "message": "Unjoined successfully"
}
```
---

## üìå Scheduler APIs

### ‚ú≥Ô∏è Manual Session Generation

- **`POST` | Manual Session Generation:** Manually triggers the background job to generate upcoming game sessions.

**Manual Session Generation**

- Triggers the scheduled job (`generate_upcoming_game_sessions`) immediately.
- This job checks games with recurrence settings (daily, weekly, etc.).
- It creates future `GameSession` entries based on the game's recurrence rules, start date/time, and configured lookahead period (`MAX_LOOKAHEAD_DAYS` in `jobs.py`).

**Endpoint:**
```
POST {{baseUrl}}/generate_session/
```

**Input Parameters:**
None

**Response Status Codes:**
- `200 OK`: Session generation job triggered successfully.
- `500 Internal Server Error`: An error occurred during job execution.

**Response Body:**
| Field | Type | Description |
| --- | --- | --- |
| `status` | string | Confirmation message indicating the job was triggered. |
| `created` | integer | Number of created session. |

**Example Usage:**
```
POST {{baseUrl}}/generate_session/
```
```
// Request Headers
N/A
```
```
// Request Body
N/A
```
```
// Response (200 OK)
{
    "status": "success",
    "created": 0
}
```
---

## üìå Not yet in used APIs

### ‚õî games/join/
> In progress

### ‚õî games/<int:game_id>/
> In progress (Superseded by `/game/{game_id}/`?)

### ‚õî players/
> In progress (Superseded by `/players/me/`?)

### ‚õî players/hosting/
> In progress

### ‚õî players/joined/
> In progress
